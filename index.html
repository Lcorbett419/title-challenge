<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title Challenge A - Football Manager</title>
    <meta name="description" content="Text-based football manager game across 5 European leagues!">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Menu = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>;
        const Trophy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const Play = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const Save = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/></svg>;

        const calculatePlayerValue = (player, asOfDate) => {
          const { positions, rating, dob } = player;
          
          const positionValues = {
            'ST': 1.0, 'LW': 0.95, 'RW': 0.95, 'CAM': 0.85, 'CM': 0.70,
            'CDM': 0.68, 'LB': 0.65, 'RB': 0.65, 'CB': 0.60, 'GK': 0.55
          };
          
          const maxMultiplier = Math.max(...positions.map(pos => positionValues[pos] || 0.5));
          
          const birthDate = new Date(dob);
          const checkDate = asOfDate || new Date();
          let age = checkDate.getFullYear() - birthDate.getFullYear();
          const monthDiff = checkDate.getMonth() - birthDate.getMonth();
          if (monthDiff < 0 || (monthDiff === 0 && checkDate.getDate() < birthDate.getDate())) {
            age--;
          }
          
          let ageMultiplier;
          if (age >= 21 && age <= 29) {
            ageMultiplier = 1.0;
          } else if (age < 21) {
            if (rating >= 14) {
              ageMultiplier = 0.6 + (age - 16) * 0.08 + (rating - 14) * 0.05;
            } else {
              ageMultiplier = 0.4 + (age - 16) * 0.12;
            }
          } else {
            ageMultiplier = Math.max(0.2, 1.0 - ((age - 29) * 0.08));
          }
          
          const baseValue = Math.pow(rating, 2) * maxMultiplier * ageMultiplier * 250000;
          return Math.min(Math.round(baseValue), 100000000);
        };

        const App = () => {
          const [databaseLoaded, setDatabaseLoaded] = useState(false);
          const [initialLeagues, setInitialLeagues] = useState(null);
          const [gameState, setGameState] = useState('main-menu');
          const [selectedLeague, setSelectedLeague] = useState(null);
          const [selectedTeam, setSelectedTeam] = useState(null);
          const [allLeagues, setAllLeagues] = useState(null);
          const [currentMatch, setCurrentMatch] = useState(null);
          const [matchCommentary, setMatchCommentary] = useState([]);
          const [fixtures, setFixtures] = useState({});
          const [currentDate, setCurrentDate] = useState(new Date('2025-08-01'));
          const [selectedPlayerForTransfer, setSelectedPlayerForTransfer] = useState(null);
          const [selectedFormation, setSelectedFormation] = useState('4-3-3');
          const [showFormationPicker, setShowFormationPicker] = useState(false);
          const [menuOpen, setMenuOpen] = useState(false);
          const [infoPage, setInfoPage] = useState('home');

          const formations = {
            '4-3-3': { GK: 1, LB: 1, CB: 2, RB: 1, CDM: 1, CM: 2, LW: 1, RW: 1, ST: 1 },
            '4-4-2': { GK: 1, LB: 1, CB: 2, RB: 1, CM: 2, CAM: 2, ST: 2 },
            '4-2-3-1': { GK: 1, LB: 1, CB: 2, RB: 1, CDM: 2, CAM: 1, LW: 1, RW: 1, ST: 1 },
            '3-5-2': { GK: 1, CB: 3, LB: 1, RB: 1, CM: 3, ST: 2 },
            '4-1-4-1': { GK: 1, LB: 1, CB: 2, RB: 1, CDM: 1, CM: 2, LW: 1, RW: 1, ST: 1 }
          };

          useEffect(() => {
            fetch('./leagues-database.json')
              .then(response => response.json())
              .then(data => {
                setInitialLeagues(data);
                setDatabaseLoaded(true);
              })
              .catch(error => {
                console.error('Error loading database:', error);
                alert('Failed to load database');
              });
          }, []);

          useEffect(() => {
            if (selectedTeam && gameState !== 'main-menu' && gameState !== 'league-select' && gameState !== 'team-select') {
              saveGame();
            }
          }, [selectedTeam, allLeagues, fixtures, currentDate, gameState]);

          const saveGame = () => {
            const gameData = {
              selectedLeague, selectedTeam, allLeagues, fixtures,
              currentDate: currentDate.toISOString(),
              selectedFormation, gameState
            };
            localStorage.setItem('footballManagerSave', JSON.stringify({ gameData }));
          };

          const newGame = () => {
            setSelectedLeague(null);
            setSelectedTeam(null);
            setAllLeagues(JSON.parse(JSON.stringify(initialLeagues)));
            setFixtures({});
            setCurrentDate(new Date('2025-08-01'));
            setSelectedFormation('4-3-3');
            localStorage.removeItem('footballManagerSave');
            setGameState('league-select');
          };

          const resumeGame = () => {
            const saved = localStorage.getItem('footballManagerSave');
            if (saved) {
              try {
                const data = JSON.parse(saved);
                if (data.gameData) {
                  setSelectedLeague(data.gameData.selectedLeague);
                  setSelectedTeam(data.gameData.selectedTeam);
                  setAllLeagues(data.gameData.allLeagues);
                  setFixtures(data.gameData.fixtures);
                  setCurrentDate(new Date(data.gameData.currentDate));
                  setSelectedFormation(data.gameData.selectedFormation || '4-3-3');
                  setGameState('info-page');
                }
              } catch (e) {
                alert('Error loading saved game');
              }
            }
          };

          const hasSavedGame = () => {
            const saved = localStorage.getItem('footballManagerSave');
            if (saved) {
              try {
                const data = JSON.parse(saved);
                return data.gameData && data.gameData.selectedTeam;
              } catch (e) {
                return false;
              }
            }
            return false;
          };

          const generateSeasonFixtures = () => {
            const newFixtures = {};
            const retirements = [];
            const warnings = [];
            
            Object.keys(allLeagues).forEach(leagueKey => {
              const league = allLeagues[leagueKey];
              const teams = league.teams;
              
              teams.forEach(team => {
                team.players = team.players.filter(player => {
                  const age = calculateAge(player.dob, currentDate);
                  const isGK = player.positions.includes('GK');
                  const retirementAge = isGK ? 38 : 36;
                  
                  if (age >= retirementAge) {
                    if (player.retirementWarning) {
                      retirements.push(`${player.name} (${team.name}) has retired at age ${age}`);
                      return false;
                    } else {
                      player.retirementWarning = true;
                      warnings.push(`${player.name} (${team.name}, age ${age}) will retire at end of season`);
                      return true;
                    }
                  }
                  return true;
                });
                
                team.players.forEach(player => {
                  if (!player.goals) player.goals = 0;
                  if (!player.injured) player.injured = false;
                  if (!player.injuryUntil) player.injuryUntil = null;
                });
              });
              
              const n = teams.length;
              const leagueFixtures = [];
              
              for (let round = 0; round < (n - 1) * 2; round++) {
                const isFirstHalf = round < n - 1;
                const baseRound = isFirstHalf ? round : round - (n - 1);
                
                for (let i = 0; i < n / 2; i++) {
                  let home = (baseRound + i) % (n - 1);
                  let away = (n - 1 - i + baseRound) % (n - 1);
                  
                  if (i === 0) away = n - 1;
                  if (!isFirstHalf) [home, away] = [away, home];
                  
                  leagueFixtures.push({
                    homeTeamId: teams[home].id,
                    awayTeamId: teams[away].id,
                    played: false,
                    homeScore: null,
                    awayScore: null,
                    scorers: [],
                    matchday: round + 1
                  });
                }
              }
              
              newFixtures[leagueKey] = leagueFixtures;
            });
            
            setFixtures(newFixtures);
            
            if (warnings.length > 0) alert('Retirement Warnings:\n\n' + warnings.join('\n'));
            if (retirements.length > 0) alert('Retirements:\n\n' + retirements.join('\n'));
          };

          const selectLeague = (leagueKey) => {
            setSelectedLeague(leagueKey);
            setGameState('team-select');
          };

          const selectTeam = (team) => {
            setSelectedTeam(team);
            setGameState('info-page');
          };
          
          useEffect(() => {
            if (selectedTeam && Object.keys(fixtures).length === 0) {
              generateSeasonFixtures();
            }
          }, [selectedTeam]);

          const getLeagueTable = (leagueKey) => {
            const league = allLeagues[leagueKey];
            const leagueFixtures = fixtures[leagueKey] || [];
            
            const table = league.teams.map(team => ({
              teamId: team.id,
              name: team.name,
              played: 0, won: 0, drawn: 0, lost: 0,
              goalsFor: 0, goalsAgainst: 0, points: 0
            }));
            
            leagueFixtures.filter(f => f.played).forEach(fixture => {
              const homeTeam = table.find(t => t.teamId === fixture.homeTeamId);
              const awayTeam = table.find(t => t.teamId === fixture.awayTeamId);
              
              if (homeTeam && awayTeam) {
                homeTeam.played++;
                awayTeam.played++;
                homeTeam.goalsFor += fixture.homeScore;
                homeTeam.goalsAgainst += fixture.awayScore;
                awayTeam.goalsFor += fixture.awayScore;
                awayTeam.goalsAgainst += fixture.homeScore;
                
                if (fixture.homeScore > fixture.awayScore) {
                  homeTeam.won++;
                  homeTeam.points += 3;
                  awayTeam.lost++;
                } else if (fixture.homeScore < fixture.awayScore) {
                  awayTeam.won++;
                  awayTeam.points += 3;
                  homeTeam.lost++;
                } else {
                  homeTeam.drawn++;
                  awayTeam.drawn++;
                  homeTeam.points++;
                  awayTeam.points++;
                }
              }
            });
            
            table.sort((a, b) => {
              if (b.points !== a.points) return b.points - a.points;
              return (b.goalsFor - b.goalsAgainst) - (a.goalsFor - a.goalsAgainst);
            });
            
            return table;
          };

          const getTeamRating = (team) => {
            if (!team || !team.players) return 0;
            return Math.round(team.players.reduce((sum, p) => sum + p.rating, 0) / team.players.length);
          };

          const getNextPlayerMatch = () => {
            const leagueFixtures = fixtures[selectedLeague] || [];
            return leagueFixtures.find(f => 
              !f.played && (f.homeTeamId === selectedTeam.id || f.awayTeamId === selectedTeam.id)
            );
          };

          const simulateMatch = (homeTeam, awayTeam, trackScorers = false) => {
            const commentary = [];
            const goalScorers = [];
            const homeRating = getTeamRating(homeTeam);
            const awayRating = getTeamRating(awayTeam);
            
            const updateInjuries = (team) => {
              team.players.forEach(player => {
                if (player.injured && player.injuryUntil) {
                  if (new Date(player.injuryUntil) <= currentDate) {
                    player.injured = false;
                    player.injuryUntil = null;
                  }
                }
              });
            };
            
            updateInjuries(homeTeam);
            updateInjuries(awayTeam);
            
            let homeScore = 0;
            let awayScore = 0;
            
            commentary.push(`${homeTeam.name} vs ${awayTeam.name}`);
            commentary.push(`Date: ${currentDate.toLocaleDateString('en-GB')}`);
            commentary.push("Kick off!");
            commentary.push("");
            
            const moments = 8 + Math.floor(Math.random() * 5);
            
            for (let i = 0; i < moments; i++) {
              const minute = Math.floor(Math.random() * 90) + 1;
              const homeChance = (homeRating + Math.random() * 10) / (homeRating + awayRating + Math.random() * 20);
              
              if (Math.random() < 0.3) {
                const selectScorer = (team) => {
                  const rand = Math.random();
                  const availablePlayers = team.players.filter(p => !p.injured);
                  
                  if (rand < 0.70) {
                    const attackers = availablePlayers.filter(p => 
                      p.positions.some(pos => ['ST', 'LW', 'RW', 'CAM'].includes(pos))
                    );
                    return attackers[Math.floor(Math.random() * attackers.length)];
                  } else if (rand < 0.90) {
                    const midfielders = availablePlayers.filter(p => 
                      p.positions.some(pos => ['CDM', 'CM'].includes(pos))
                    );
                    return midfielders[Math.floor(Math.random() * midfielders.length)];
                  } else if (rand < 0.999) {
                    const defenders = availablePlayers.filter(p => 
                      p.positions.some(pos => ['LB', 'CB', 'RB'].includes(pos))
                    );
                    return defenders[Math.floor(Math.random() * defenders.length)];
                  } else {
                    return availablePlayers.find(p => p.positions.includes('GK'));
                  }
                };
                
                if (Math.random() < homeChance) {
                  const scorer = selectScorer(homeTeam);
                  if (scorer && Math.random() < 0.4) {
                    homeScore++;
                    commentary.push(`${minute}' GOAL! ${scorer.name} scores! ${homeScore}-${awayScore}`);
                    if (trackScorers) goalScorers.push({ playerId: scorer.id, teamId: homeTeam.id });
                  } else if (scorer) {
                    commentary.push(`${minute}' ${scorer.name} shot saved!`);
                  }
                } else {
                  const scorer = selectScorer(awayTeam);
                  if (scorer && Math.random() < 0.4) {
                    awayScore++;
                    commentary.push(`${minute}' GOAL! ${scorer.name} scores! ${homeScore}-${awayScore}`);
                    if (trackScorers) goalScorers.push({ playerId: scorer.id, teamId: awayTeam.id });
                  } else if (scorer) {
                    commentary.push(`${minute}' ${scorer.name} shoots wide!`);
                  }
                }
              }
            }
            
            [homeTeam, awayTeam].forEach(team => {
              team.players.forEach(player => {
                if (!player.injured && Math.random() < 0.01) {
                  player.injured = true;
                  const weeksOut = 1 + Math.floor(Math.random() * 4);
                  const injuryDate = new Date(currentDate);
                  injuryDate.setDate(injuryDate.getDate() + (weeksOut * 7));
                  player.injuryUntil = injuryDate.toISOString();
                  
                  if (team.id === selectedTeam.id) {
                    commentary.push("");
                    commentary.push(`‚öïÔ∏è INJURY: ${player.name} out for ${weeksOut} week${weeksOut > 1 ? 's' : ''}`);
                  }
                }
              });
            });
            
            commentary.push("");
            commentary.push(`FULL TIME: ${homeTeam.name} ${homeScore} - ${awayScore} ${awayTeam.name}`);
            
            return { homeScore, awayScore, commentary, scorers: goalScorers };
          };

          const playNextMatch = () => {
            if (!showFormationPicker) {
              setShowFormationPicker(true);
              setGameState('formation-picker');
              return;
            }
            
            const nextMatch = getNextPlayerMatch();
            
            if (!nextMatch) {
              const newSeasonStart = new Date(currentDate);
              newSeasonStart.setFullYear(newSeasonStart.getFullYear() + 1);
              newSeasonStart.setMonth(7);
              newSeasonStart.setDate(1);
              
              alert(`Season Complete!`);
              setCurrentDate(newSeasonStart);
              generateSeasonFixtures();
              return;
            }
            
            const league = allLeagues[selectedLeague];
            const homeTeam = nextMatch.homeTeamId === selectedTeam.id 
              ? selectedTeam 
              : league.teams.find(t => t.id === nextMatch.homeTeamId);
            const awayTeam = nextMatch.awayTeamId === selectedTeam.id 
              ? selectedTeam 
              : league.teams.find(t => t.id === nextMatch.awayTeamId);
            
            const result = simulateMatch(homeTeam, awayTeam, true);
            
            const updatedFixtures = JSON.parse(JSON.stringify(fixtures));
            const playerLeagueFixtures = updatedFixtures[selectedLeague];
            
            for (let i = 0; i < playerLeagueFixtures.length; i++) {
              if (playerLeagueFixtures[i].homeTeamId === nextMatch.homeTeamId && 
                  playerLeagueFixtures[i].awayTeamId === nextMatch.awayTeamId && 
                  !playerLeagueFixtures[i].played) {
                playerLeagueFixtures[i].played = true;
                playerLeagueFixtures[i].homeScore = result.homeScore;
                playerLeagueFixtures[i].awayScore = result.awayScore;
                playerLeagueFixtures[i].scorers = result.scorers || [];
                
                result.scorers.forEach(scorer => {
                  const team = league.teams.find(t => t.id === scorer.teamId);
                  if (team) {
                    const player = team.players.find(p => p.id === scorer.playerId);
                    if (player) player.goals = (player.goals || 0) + 1;
                  }
                });
                break;
              }
            }
            
            Object.keys(allLeagues).forEach(leagueKey => {
              const lg = allLeagues[leagueKey];
              const lgFixtures = updatedFixtures[leagueKey];
              
              if (!lgFixtures) return;
              
              const playedCount = lgFixtures.filter(f => f.played).length;
              const currentMatchday = Math.floor(playedCount / (lg.teams.length / 2)) + 1;
              const matchdayFixtures = lgFixtures.filter(f => f.matchday === currentMatchday && !f.played);
              
              matchdayFixtures.forEach(fixture => {
                const hTeam = lg.teams.find(t => t.id === fixture.homeTeamId);
                const aTeam = lg.teams.find(t => t.id === fixture.awayTeamId);
                
                if (hTeam && aTeam) {
                  const res = simulateMatch(hTeam, aTeam, true);
                  fixture.played = true;
                  fixture.homeScore = res.homeScore;
                  fixture.awayScore = res.awayScore;
                  fixture.scorers = res.scorers || [];
                  
                  res.scorers.forEach(scorer => {
                    const team = lg.teams.find(t => t.id === scorer.teamId);
                    if (team) {
                      const player = team.players.find(p => p.id === scorer.playerId);
                      if (player) player.goals = (player.goals || 0) + 1;
                    }
                  });
                }
              });
            });
            
            setFixtures(updatedFixtures);
            
            setCurrentMatch({
              opponent: nextMatch.homeTeamId === selectedTeam.id ? awayTeam.name : homeTeam.name,
              playerScore: nextMatch.homeTeamId === selectedTeam.id ? result.homeScore : result.awayScore,
              opponentScore: nextMatch.homeTeamId === selectedTeam.id ? result.awayScore : result.homeScore,
              isHome: nextMatch.homeTeamId === selectedTeam.id
            });
            
            setMatchCommentary(result.commentary);
            
            const newDate = new Date(currentDate);
            newDate.setDate(newDate.getDate() + (3 + Math.floor(Math.random() * 2)));
            
            if (newDate.getMonth() === 6 && newDate.getDate() > 30) {
              newDate.setMonth(7);
              newDate.setDate(1);
              newDate.setFullYear(newDate.getFullYear() + 1);
            }
            
            setCurrentDate(newDate);
            setShowFormationPicker(false);
            setGameState('match-result');
          };
          
          const getTopScorers = (leagueKey) => {
            const league = allLeagues[leagueKey];
            const scorers = [];
            
            league.teams.forEach(team => {
              team.players.forEach(player => {
                if (player.goals && player.goals > 0) {
                  scorers.push({ name: player.name, team: team.name, goals: player.goals });
                }
              });
            });
            
            scorers.sort((a, b) => b.goals - a.goals);
            return scorers.slice(0, 10);
          };

          const calculateAge = (dob, asOfDate = currentDate) => {
            const birthDate = new Date(dob);
            let age = asOfDate.getFullYear() - birthDate.getFullYear();
            const monthDiff = asOfDate.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && asOfDate.getDate() < birthDate.getDate())) age--;
            return age;
          };

          const formatCurrency = (amount) => '¬£' + (amount / 1000000).toFixed(1) + 'M';
          const formatDate = (date) => new Date(date).toLocaleDateString('en-GB');
          const getPlayerValueWithDate = (player) => calculatePlayerValue(player, currentDate);

          if (!databaseLoaded || !initialLeagues) {
            return (
              <div className="min-h-screen bg-gray-900 flex items-center justify-center">
                <div className="text-white text-2xl">Loading...</div>
              </div>
            );
          }

          // SECTION 1: Main Menu
          if (gameState === 'main-menu') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 flex items-center justify-center p-4">
                <div className="max-w-md w-full">
                  <div className="text-center mb-12">
                    <div className="w-24 h-24 mx-auto mb-6 text-green-500 flex items-center justify-center">
                      <Trophy />
                    </div>
                    <h1 className="text-5xl font-bold text-white mb-3">Title Challenge</h1>
                    <p className="text-gray-400 text-lg">Football Manager</p>
                  </div>
                  
                  <div className="space-y-4">
                    <button
                      onClick={newGame}
                      className="w-full bg-green-600 text-white py-6 rounded-lg font-bold text-xl hover:bg-green-700 transition"
                    >
                      New Game
                    </button>
                    
                    <button
                      onClick={resumeGame}
                      disabled={!hasSavedGame()}
                      className={`w-full py-6 rounded-lg font-bold text-xl transition ${
                        hasSavedGame()
                          ? 'bg-gray-700 text-white hover:bg-gray-600'
                          : 'bg-gray-800 text-gray-600 cursor-not-allowed'
                      }`}
                    >
                      Load Game
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // League Selection
          if (gameState === 'league-select') {
            return (
              <div className="min-h-screen bg-gray-900 p-4">
                <div className="max-w-4xl mx-auto pt-8">
                  <h1 className="text-4xl font-bold text-white mb-8 text-center">Choose Your League</h1>
                  
                  <div className="space-y-4">
                    {Object.keys(initialLeagues).map(leagueKey => {
                      const league = initialLeagues[leagueKey];
                      return (
                        <div
                          key={leagueKey}
                          onClick={() => selectLeague(leagueKey)}
                          className="bg-gray-800 rounded-lg p-6 cursor-pointer hover:bg-gray-700 transition border-2 border-transparent hover:border-green-600"
                        >
                          <h2 className="text-2xl font-bold text-white mb-2">{league.name}</h2>
                          <p className="text-gray-400">{league.country} ‚Ä¢ {league.teams.length} teams</p>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            );
          }

          // Team Selection
          if (gameState === 'team-select') {
            const league = initialLeagues[selectedLeague];
            
            return (
              <div className="min-h-screen bg-gray-900 p-4">
                <div className="max-w-4xl mx-auto pt-8">
                  <h1 className="text-4xl font-bold text-white mb-8 text-center">{league.name}</h1>
                  
                  <div className="grid gap-4">
                    {league.teams.map(team => (
                      <div
                        key={team.id}
                        onClick={() => selectTeam(team)}
                        className="bg-gray-800 rounded-lg p-6 cursor-pointer hover:bg-gray-700 transition border-2 border-transparent hover:border-green-600"
                      >
                        <div className="flex justify-between items-center">
                          <div>
                            <h2 className="text-2xl font-bold text-white">{team.name}</h2>
                            <p className="text-gray-400">Squad: {team.players.length} | Budget: {formatCurrency(team.budget)}</p>
                          </div>
                          <div className="text-3xl font-bold text-green-500">{getTeamRating(team)}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            );
          }

          // SECTION 2: Information Page
          if (gameState === 'info-page') {
            const nextMatch = getNextPlayerMatch();
            const table = getLeagueTable(selectedLeague);
            const playerPosition = table.findIndex(t => t.teamId === selectedTeam.id);
            const playerTableEntry = table[playerPosition];
            
            // Get teams around player
            const tableContext = [];
            for (let i = Math.max(0, playerPosition - 2); i <= Math.min(table.length - 1, playerPosition + 2); i++) {
              tableContext.push(table[i]);
            }
            
            const opponent = nextMatch ? (
              nextMatch.homeTeamId === selectedTeam.id
                ? allLeagues[selectedLeague].teams.find(t => t.id === nextMatch.awayTeamId)
                : allLeagues[selectedLeague].teams.find(t => t.id === nextMatch.homeTeamId)
            ) : null;
            
            const opponentPosition = opponent ? table.findIndex(t => t.teamId === opponent.id) + 1 : null;

            return (
              <div className="min-h-screen bg-gray-900">
                {/* Header */}
                <div className="bg-orange-600 p-4 flex justify-between items-center">
                  <button
                    onClick={() => setMenuOpen(!menuOpen)}
                    className="text-white p-2"
                  >
                    <Menu />
                  </button>
                  <div className="text-center">
                    <div className="text-white text-sm">Week {Math.floor((fixtures[selectedLeague]?.filter(f => f.played).length || 0) / 10) + 1}</div>
                    <div className="text-white font-bold">Season {currentDate.getFullYear() - 2024}</div>
                  </div>
                  <div className="w-10"></div>
                </div>

                {/* Side Menu */}
                {menuOpen && (
                  <div className="fixed inset-0 bg-black/50 z-50" onClick={() => setMenuOpen(false)}>
                    <div className="bg-gray-800 w-64 h-full" onClick={(e) => e.stopPropagation()}>
                      <div className="p-4">
                        <h2 className="text-white font-bold text-xl mb-4">{selectedTeam.name}</h2>
                        <div className="space-y-2">
                          <button
                            onClick={() => { setInfoPage('home'); setMenuOpen(false); }}
                            className="w-full text-left text-white py-2 px-3 rounded hover:bg-gray-700"
                          >
                            Home
                          </button>
                          <button
                            onClick={() => { setInfoPage('squad'); setMenuOpen(false); }}
                            className="w-full text-left text-white py-2 px-3 rounded hover:bg-gray-700"
                          >
                            Squad
                          </button>
                          <button
                            onClick={() => { setInfoPage('table'); setMenuOpen(false); }}
                            className="w-full text-left text-white py-2 px-3 rounded hover:bg-gray-700"
                          >
                            League Table
                          </button>
                          <button
                            onClick={() => { setInfoPage('fixtures'); setMenuOpen(false); }}
                            className="w-full text-left text-white py-2 px-3 rounded hover:bg-gray-700"
                          >
                            Fixtures
                          </button>
                          <button
                            onClick={() => { setInfoPage('scorers'); setMenuOpen(false); }}
                            className="w-full text-left text-white py-2 px-3 rounded hover:bg-gray-700"
                          >
                            Top Scorers
                          </button>
                          <button
                            onClick={() => { setInfoPage('transfers'); setMenuOpen(false); }}
                            className="w-full text-left text-white py-2 px-3 rounded hover:bg-gray-700"
                          >
                            Transfers
                          </button>
                          <button
                            onClick={() => setGameState('main-menu')}
                            className="w-full text-left text-red-400 py-2 px-3 rounded hover:bg-gray-700 mt-4"
                          >
                            Main Menu
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Date Banner */}
                <div className="bg-gray-800 p-3 text-center border-b border-gray-700">
                  <div className="text-orange-500 text-sm">üìÖ {formatDate(currentDate)}</div>
                </div>

                {/* Content Area */}
                <div className="p-4 max-w-4xl mx-auto">
                  {infoPage === 'home' && (
                    <>
                      {/* Next Fixture */}
                      {nextMatch && opponent && (
                        <div className="bg-gray-800 rounded-lg p-6 mb-4">
                          <div className="text-gray-400 text-sm mb-2">NEXT FIXTURE</div>
                          <div className="flex items-center justify-between">
                            <div className="text-center flex-1">
                              <div className="text-white font-bold text-lg">{nextMatch.homeTeamId === selectedTeam.id ? selectedTeam.name : opponent.name}</div>
                              <div className="text-gray-500 text-sm">{nextMatch.homeTeamId === selectedTeam.id ? playerPosition + 1 : opponentPosition}th</div>
                            </div>
                            <div className="text-gray-400 font-bold text-xl px-4">vs</div>
                            <div className="text-center flex-1">
                              <div className="text-white font-bold text-lg">{nextMatch.awayTeamId === selectedTeam.id ? selectedTeam.name : opponent.name}</div>
                              <div className="text-gray-500 text-sm">{nextMatch.awayTeamId === selectedTeam.id ? playerPosition + 1 : opponentPosition}th</div>
                            </div>
                          </div>
                        </div>
                      )}

                      {/* Quick League Table */}
                      <div className="bg-gray-800 rounded-lg p-4 mb-4">
                        <div className="flex justify-between items-center mb-3">
                          <h3 className="text-white font-bold">League Table</h3>
                          <button
                            onClick={() => setInfoPage('table')}
                            className="text-orange-500 text-sm"
                          >
                            View Full ‚Üí
                          </button>
                        </div>
                        <table className="w-full text-sm">
                          <thead>
                            <tr className="text-gray-500 text-xs">
                              <th className="text-left">Pos</th>
                              <th className="text-left">Team</th>
                              <th className="text-center">Pld</th>
                              <th className="text-center">GD</th>
                              <th className="text-center">Pts</th>
                            </tr>
                          </thead>
                          <tbody>
                            {tableContext.map((team, idx) => (
                              <tr key={team.teamId} className={team.teamId === selectedTeam.id ? 'bg-green-900/30' : ''}>
                                <td className="text-white py-2">{table.findIndex(t => t.teamId === team.teamId) + 1}</td>
                                <td className="text-white font-semibold">{team.name}</td>
                                <td className="text-center text-gray-400">{team.played}</td>
                                <td className="text-center text-gray-400">{team.goalsFor - team.goalsAgainst}</td>
                                <td className="text-center text-white font-bold">{team.points}</td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>

                      {/* Finances */}
                      <div className="bg-gray-800 rounded-lg p-4 mb-4">
                        <div className="text-gray-400 text-sm mb-1">Finances: Balance</div>
                        <div className="text-white font-bold text-3xl">{formatCurrency(selectedTeam.budget)}</div>
                      </div>
                    </>
                  )}

                  {infoPage === 'squad' && (
                    <div className="bg-gray-800 rounded-lg p-4">
                      <h2 className="text-white font-bold text-xl mb-4">Squad</h2>
                      <div className="space-y-2">
                        {selectedTeam.players.map(player => (
                          <div key={player.id} className={`rounded p-3 ${player.injured ? 'bg-red-900/20' : 'bg-gray-700'}`}>
                            <div className="flex justify-between">
                              <div>
                                <div className="text-white font-semibold">
                                  {player.name}
                                  {player.injured && <span className="text-red-400 ml-2">‚öïÔ∏è</span>}
                                </div>
                                <div className="text-gray-400 text-sm">
                                  {player.positions.join('/')} ‚Ä¢ Age {calculateAge(player.dob)}
                                  {player.goals > 0 && <span className="text-yellow-400 ml-2">‚öΩ {player.goals}</span>}
                                </div>
                              </div>
                              <div className="text-green-500 font-semibold">{formatCurrency(getPlayerValueWithDate(player))}</div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {infoPage === 'table' && (
                    <div className="bg-gray-800 rounded-lg p-4">
                      <h2 className="text-white font-bold text-xl mb-4">{allLeagues[selectedLeague].name}</h2>
                      <table className="w-full text-sm">
                        <thead>
                          <tr className="text-gray-400 border-b border-gray-700">
                            <th className="text-left p-2">Pos</th>
                            <th className="text-left p-2">Team</th>
                            <th className="text-center p-2">P</th>
                            <th className="text-center p-2">W</th>
                            <th className="text-center p-2">D</th>
                            <th className="text-center p-2">L</th>
                            <th className="text-center p-2">Pts</th>
                          </tr>
                        </thead>
                        <tbody>
                          {table.map((team, index) => (
                            <tr key={team.teamId} className={`border-b border-gray-700 ${team.teamId === selectedTeam.id ? 'bg-green-900/30' : ''}`}>
                              <td className="text-white p-2 font-bold">{index + 1}</td>
                              <td className="text-white p-2">{team.name}</td>
                              <td className="text-center text-gray-400 p-2">{team.played}</td>
                              <td className="text-center text-gray-400 p-2">{team.won}</td>
                              <td className="text-center text-gray-400 p-2">{team.drawn}</td>
                              <td className="text-center text-gray-400 p-2">{team.lost}</td>
                              <td className="text-center text-white font-bold p-2">{team.points}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  )}

                  {infoPage === 'fixtures' && (
                    <div className="bg-gray-800 rounded-lg p-4">
                      <h2 className="text-white font-bold text-xl mb-4">Fixtures</h2>
                      <div className="space-y-2 max-h-96 overflow-y-auto">
                        {(fixtures[selectedLeague] || []).map((fixture, index) => {
                          const league = allLeagues[selectedLeague];
                          const homeTeam = league.teams.find(t => t.id === fixture.homeTeamId);
                          const awayTeam = league.teams.find(t => t.id === fixture.awayTeamId);
                          const isPlayerMatch = fixture.homeTeamId === selectedTeam.id || fixture.awayTeamId === selectedTeam.id;
                          
                          return (
                            <div key={index} className={`p-3 rounded ${isPlayerMatch ? fixture.played ? 'bg-green-900/30' : 'bg-orange-900/30' : 'bg-gray-700'}`}>
                              <div className="flex justify-between text-sm">
                                <span className="text-white">{homeTeam?.name} vs {awayTeam?.name}</span>
                                {fixture.played ? (
                                  <span className="text-white font-bold">{fixture.homeScore} - {fixture.awayScore}</span>
                                ) : (
                                  <span className="text-gray-500">-</span>
                                )}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  {infoPage === 'scorers' && (
                    <div className="bg-gray-800 rounded-lg p-4">
                      <h2 className="text-white font-bold text-xl mb-4">‚öΩ Top Scorers</h2>
                      {Object.keys(allLeagues).map(leagueKey => {
                        const league = allLeagues[leagueKey];
                        const topScorers = getTopScorers(leagueKey);
                        return (
                          <div key={leagueKey} className="mb-6">
                            <h3 className="text-orange-500 font-bold mb-3">{league.name}</h3>
                            {topScorers.length > 0 ? (
                              <div className="space-y-2">
                                {topScorers.map((scorer, i) => (
                                  <div key={i} className="flex justify-between text-sm bg-gray-700 p-2 rounded">
                                    <span className="text-white"><span className="text-orange-500 mr-2">{i + 1}.</span>{scorer.name} <span className="text-gray-400 text-xs">({scorer.team})</span></span>
                                    <span className="text-white font-bold">{scorer.goals}</span>
                                  </div>
                                ))}
                              </div>
                            ) : (
                              <p className="text-gray-500 text-sm">No goals yet</p>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )}

                  {infoPage === 'transfers' && (
                    <div className="bg-gray-800 rounded-lg p-4">
                      <h2 className="text-white font-bold text-xl mb-4">Transfers</h2>
                      <p className="text-gray-400 text-sm mb-4">Budget: {formatCurrency(selectedTeam.budget)}</p>
                      <p className="text-gray-500">Transfer market coming soon...</p>
                    </div>
                  )}
                </div>

                {/* Continue Button */}
                {nextMatch && infoPage === 'home' && (
                  <div className="fixed bottom-0 left-0 right-0 p-4 bg-gray-900">
                    <button
                      onClick={() => {
                        setShowFormationPicker(true);
                        setGameState('formation-picker');
                      }}
                      className="w-full bg-green-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-700"
                    >
                      Continue
                    </button>
                  </div>
                )}
              </div>
            );
          }

          // Formation Picker
          if (gameState === 'formation-picker') {
            const nextMatch = getNextPlayerMatch();
            const opponent = nextMatch ? (
              nextMatch.homeTeamId === selectedTeam.id
                ? allLeagues[selectedLeague].teams.find(t => t.id === nextMatch.awayTeamId)
                : allLeagues[selectedLeague].teams.find(t => t.id === nextMatch.homeTeamId)
            ) : null;
            
            const injuredPlayers = selectedTeam.players.filter(p => p.injured);
            
            return (
              <div className="min-h-screen bg-gray-900 p-4">
                <div className="max-w-2xl mx-auto">
                  <h1 className="text-white font-bold text-2xl mb-4">Pre-Match Setup</h1>
                  <div className="bg-gray-800 rounded-lg p-4 mb-4">
                    <p className="text-white text-lg">{selectedTeam.name} vs {opponent?.name}</p>
                    <p className="text-gray-400 text-sm">{nextMatch?.homeTeamId === selectedTeam.id ? 'Home' : 'Away'} ‚Ä¢ {formatDate(currentDate)}</p>
                  </div>

                  {injuredPlayers.length > 0 && (
                    <div className="bg-red-900/20 rounded-lg p-4 mb-4">
                      <h3 className="text-red-400 font-bold mb-2">‚öïÔ∏è Injured Players</h3>
                      {injuredPlayers.map(p => (
                        <p key={p.id} className="text-red-300 text-sm">{p.name} - Returns {formatDate(p.injuryUntil)}</p>
                      ))}
                    </div>
                  )}

                  <div className="bg-gray-800 rounded-lg p-4 mb-4">
                    <h2 className="text-white font-bold mb-4">Formation</h2>
                    <div className="grid grid-cols-2 gap-3">
                      {Object.keys(formations).map(formation => (
                        <button
                          key={formation}
                          onClick={() => setSelectedFormation(formation)}
                          className={`p-4 rounded-lg font-bold transition ${
                            selectedFormation === formation
                              ? 'bg-orange-600 text-white'
                              : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                          }`}
                        >
                          {formation}
                        </button>
                      ))}
                    </div>
                  </div>

                  <button
                    onClick={playNextMatch}
                    className="w-full bg-green-600 text-white py-4 rounded-lg font-bold text-xl hover:bg-green-700"
                  >
                    Start Match
                  </button>
                </div>
              </div>
            );
          }

          // SECTION 3: Match Result (Gameplay)
          if (gameState === 'match-result') {
            const resultText = 
              currentMatch.playerScore > currentMatch.opponentScore ? 'VICTORY!' :
              currentMatch.playerScore < currentMatch.opponentScore ? 'DEFEAT' :
              'DRAW';
            
            const resultColor = 
              currentMatch.playerScore > currentMatch.opponentScore ? 'text-green-400' :
              currentMatch.playerScore < currentMatch.opponentScore ? 'text-red-400' :
              'text-yellow-400';

            return (
              <div className="min-h-screen bg-gray-900 p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-gray-800 rounded-lg p-6 mb-4">
                    <h1 className={`text-4xl font-bold text-center mb-4 ${resultColor}`}>{resultText}</h1>
                    <div className="text-center text-white text-3xl font-bold mb-2">
                      {currentMatch.isHome ? selectedTeam.name : currentMatch.opponent} {currentMatch.playerScore} - {currentMatch.opponentScore} {currentMatch.isHome ? currentMatch.opponent : selectedTeam.name}
                    </div>
                    <p className="text-center text-gray-400">{formatDate(currentDate)}</p>
                  </div>

                  <div className="bg-gray-800 rounded-lg p-6 mb-4 max-h-96 overflow-y-auto">
                    <h2 className="text-white font-bold mb-4">Match Commentary</h2>
                    {matchCommentary.map((comment, index) => (
                      <p key={index} className="text-gray-300 mb-2 text-sm font-mono">{comment}</p>
                    ))}
                  </div>

                  <button
                    onClick={() => setGameState('info-page')}
                    className="w-full bg-green-600 text-white py-4 rounded-lg font-bold text-xl hover:bg-green-700"
                  >
                    Continue
                  </button>
                </div>
              </div>
            );
          }

          return null;
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
