const startNewSeason = () => {
            // Check if season is complete
            const fix = fixtures[league] || [];
            const seasonComplete = fix.length > 0 && fix.every(f => f.played);
            
            if (!seasonComplete) {
              alert('Season not complete yet!');
              return;
            }

            // Get final table
            const tbl = getTable(league);
            const playerPos = tbl.findIndex(t => t.teamId === team.id);
            
            // Define league hierarchy by country
            const leaguePyramids = {
              england: ['england', 'england_championship', 'england_league1', 'england_league2'],
              germany: ['germany', 'germany_2'],
              spain: ['spain', 'spain_segunda'],
              france: ['france', 'france_ligue2'],
              italy: ['italy', 'italy_serieb']
            };
            
            // Find which country and tier we're in
            let country = null;
            let currentTier = -1;
            
            for (const [countryKey, pyramid] of Object.entries(leaguePyramids)) {
              const tierIndex = pyramid.indexOf(league);
              if (tierIndex !== -1) {
                country = countryKey;
                currentTier = tierIndex;
                break;
              }
            }
            
            if (!country) {
              alert('Error: League not found in pyramid system');
              return;
            }
            
            const pyramid = leaguePyramids[country];
            let newLeague = league;
            let message = '';
            
            // Check for promotion (top 2) or relegation (bottom 3)
            if (playerPos < 2 && currentTier > 0) {
              // PROMOTED!
              newLeague = pyramid[currentTier - 1];
              message = `ðŸŽ‰ PROMOTED! You finished ${playerPos + 1}${playerPos === 0 ? 'st' : 'nd'} and are promoted to ${db[newLeague].name}!`;
            } else if (playerPos >= tbl.length - 3 && currentTier < pyramid.length - 1) {
              // RELEGATED
              newLeague = pyramid[currentTier + 1];
              message = `ðŸ˜¢ RELEGATED. You finished ${playerPos + 1}th and are relegated to ${db[newLeague].name}.`;
            } else if (playerPos === 0 && currentTier === 0) {
              // WON THE TOP LEAGUE!
              message = `ðŸ† CHAMPIONS! You won ${leagues[league].name}! You are the best team in ${leagues[league].country}!`;
            } else if (playerPos === 0) {
              // WON A LOWER LEAGUE!
              message = `ðŸ† CHAMPIONS! You won ${leagues[league].name}!`;
            } else {
              message = `Season complete! You finished ${playerPos + 1}${playerPos === 1 ? 'nd' : playerPos === 2 ? 'rd' : 'th'}.`;
            }
            
            // Show message
            alert(message);
            
            // Handle league change if promoted/relegated
            if (newLeague !== league) {
              // Transfer team to new league
              const oldLeague = leagues[league];
              const newLeagueData = leagues[newLeague];
              
              // Remove team from old league
              oldLeague.teams = oldLeague.teams.filter(t => t.id !== team.id);
              
              // Add team to new league (replace a random team)
              const replaceIdx = Math.floor(Math.random() * newLeagueData.teams.length);
              newLeagueData.teams[replaceIdx] = team;
              
              setLeague(newLeague);
            }
            
            // Season runs Aug 1 - Jul 31. New season starts Aug 1 of the next year.
            const seasonYear = date.getMonth() >= 7 ? date.getFullYear() + 1 : date.getFullYear();
            const newDate = new Date(`${seasonYear}-08-01`);
            setDate(newDate);
            
            // Reset goals and clear all injuries for the new season
            Object.keys(leagues).forEach(lk => {
              leagues[lk].teams.forEach(tm => {
                tm.players.forEach(p => {
                  p.goals = 0;
                  p.injured = false;
                  p.injuryUntil = null;
                });
              });
            });
            
            generateFixtures();
          };
