<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title Challenge - Football Manager</title>
    <meta name="description" content="Text-based football manager game across 5 European leagues!">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Trophy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;
        const Users = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const TrendingUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        const Calendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>;
        const Home = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const Play = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const Save = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const ArrowLeftRight = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3 4 7l4 4"/><path d="M4 7h16"/><path d="m16 21 4-4-4-4"/><path d="M20 17H4"/></svg>;
        const Globe = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>;

        const App = () => {
          const [databaseLoaded, setDatabaseLoaded] = useState(false);
          const [initialLeagues, setInitialLeagues] = useState(null);
          const [gameState, setGameState] = useState('main-menu');
          const [selectedLeague, setSelectedLeague] = useState(null);
          const [selectedTeam, setSelectedTeam] = useState(null);
          const [allLeagues, setAllLeagues] = useState(null);
          const [currentMatch, setCurrentMatch] = useState(null);
          const [matchCommentary, setMatchCommentary] = useState([]);
          const [leagueTables, setLeagueTables] = useState({});
          const [matchesPlayed, setMatchesPlayed] = useState(0);
          const [selectedPlayerForTransfer, setSelectedPlayerForTransfer] = useState(null);

          // Load database
          useEffect(() => {
            fetch('./leagues-database.json')
              .then(response => response.json())
              .then(data => {
                setInitialLeagues(data);
                setDatabaseLoaded(true);
              })
              .catch(error => {
                console.error('Error loading database:', error);
                alert('Failed to load database. Please refresh the page.');
              });
          }, []);

          useEffect(() => {
            if (selectedTeam && gameState !== 'main-menu' && gameState !== 'league-select' && gameState !== 'team-select') {
              saveGame();
            }
          }, [selectedTeam, allLeagues, leagueTables, matchesPlayed, gameState]);

          const saveGame = () => {
            const gameData = {
              selectedLeague,
              selectedTeam,
              allLeagues,
              leagueTables,
              matchesPlayed,
              gameState
            };
            localStorage.setItem('footballManagerSave', JSON.stringify({ gameData }));
          };

          const newGame = () => {
            setSelectedLeague(null);
            setSelectedTeam(null);
            setAllLeagues(JSON.parse(JSON.stringify(initialLeagues)));
            setLeagueTables({});
            setMatchesPlayed(0);
            localStorage.removeItem('footballManagerSave');
            setGameState('league-select');
          };

          const resumeGame = () => {
            const saved = localStorage.getItem('footballManagerSave');
            if (saved) {
              try {
                const data = JSON.parse(saved);
                if (data.gameData) {
                  setSelectedLeague(data.gameData.selectedLeague);
                  setSelectedTeam(data.gameData.selectedTeam);
                  setAllLeagues(data.gameData.allLeagues);
                  setLeagueTables(data.gameData.leagueTables);
                  setMatchesPlayed(data.gameData.matchesPlayed);
                  setGameState(data.gameData.gameState === 'main-menu' ? 'squad' : data.gameData.gameState);
                }
              } catch (e) {
                alert('Error loading saved game');
              }
            }
          };

          const hasSavedGame = () => {
            const saved = localStorage.getItem('footballManagerSave');
            if (saved) {
              try {
                const data = JSON.parse(saved);
                return data.gameData && data.gameData.selectedTeam;
              } catch (e) {
                return false;
              }
            }
            return false;
          };

          const initializeAllLeagueTables = () => {
            const tables = {};
            Object.keys(allLeagues).forEach(leagueKey => {
              const league = allLeagues[leagueKey];
              tables[leagueKey] = league.teams.map(team => ({
                teamId: team.id,
                name: team.name,
                played: 0,
                won: 0,
                drawn: 0,
                lost: 0,
                goalsFor: 0,
                goalsAgainst: 0,
                points: 0
              }));
            });
            setLeagueTables(tables);
          };

          const selectLeague = (leagueKey) => {
            setSelectedLeague(leagueKey);
            setGameState('team-select');
          };

          const selectTeam = (team) => {
            setSelectedTeam(team);
            initializeAllLeagueTables();
            setGameState('squad');
          };

          const getTeamRating = (team) => {
            if (!team || !team.players) return 0;
            const total = team.players.reduce((sum, player) => sum + player.rating, 0);
            return Math.round(total / team.players.length);
          };

          const simulateMatch = (homeTeam, awayTeam) => {
            const commentary = [];
            const homeRating = getTeamRating(homeTeam);
            const awayRating = getTeamRating(awayTeam);
            
            let homeScore = 0;
            let awayScore = 0;
            
            commentary.push(`${homeTeam.name} vs ${awayTeam.name}`);
            commentary.push("Kick off!");
            commentary.push("");
            
            const moments = 8 + Math.floor(Math.random() * 5);
            
            for (let i = 0; i < moments; i++) {
              const minute = Math.floor(Math.random() * 90) + 1;
              const homeChance = (homeRating + Math.random() * 10) / (homeRating + awayRating + Math.random() * 20);
              
              if (Math.random() < 0.3) {
                if (Math.random() < homeChance) {
                  const scorer = homeTeam.players.find(p => p.position === 'FWD' || p.position === 'MID');
                  if (scorer && Math.random() < 0.4) {
                    homeScore++;
                    commentary.push(`${minute}' GOAL! ${scorer.name} scores for ${homeTeam.name}! ${homeScore}-${awayScore}`);
                  } else if (scorer) {
                    commentary.push(`${minute}' ${scorer.name} with a shot, but it's saved!`);
                  }
                } else {
                  const scorer = awayTeam.players.find(p => p.position === 'FWD' || p.position === 'MID');
                  if (scorer && Math.random() < 0.4) {
                    awayScore++;
                    commentary.push(`${minute}' GOAL! ${scorer.name} scores for ${awayTeam.name}! ${homeScore}-${awayScore}`);
                  } else if (scorer) {
                    commentary.push(`${minute}' ${scorer.name} shoots wide!`);
                  }
                }
              } else {
                const events = [
                  "Good passing move in midfield",
                  "Strong tackle breaks up the attack",
                  "Corner kick awarded",
                  "Free kick in a dangerous position",
                  "Counter attack developing",
                  "Possession being retained well"
                ];
                const team = Math.random() < homeChance ? homeTeam.name : awayTeam.name;
                commentary.push(`${minute}' ${events[Math.floor(Math.random() * events.length)]} - ${team}`);
              }
            }
            
            commentary.push("");
            commentary.push(`FULL TIME: ${homeTeam.name} ${homeScore} - ${awayScore} ${awayTeam.name}`);
            
            return { homeScore, awayScore, commentary };
          };

          const updateLeagueTable = (leagueKey, team1Id, team2Id, team1Score, team2Score) => {
            const table = leagueTables[leagueKey];
            const t1Index = table.findIndex(t => t.teamId === team1Id);
            const t2Index = table.findIndex(t => t.teamId === team2Id);

            if (t1Index !== -1 && t2Index !== -1) {
              table[t1Index].played++;
              table[t1Index].goalsFor += team1Score;
              table[t1Index].goalsAgainst += team2Score;
              
              table[t2Index].played++;
              table[t2Index].goalsFor += team2Score;
              table[t2Index].goalsAgainst += team1Score;
              
              if (team1Score > team2Score) {
                table[t1Index].won++;
                table[t1Index].points += 3;
                table[t2Index].lost++;
              } else if (team1Score < team2Score) {
                table[t1Index].lost++;
                table[t2Index].won++;
                table[t2Index].points += 3;
              } else {
                table[t1Index].drawn++;
                table[t2Index].drawn++;
                table[t1Index].points++;
                table[t2Index].points++;
              }

              table.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return (b.goalsFor - b.goalsAgainst) - (a.goalsFor - a.goalsAgainst);
              });
            }
          };

          const simulateOtherMatches = () => {
            const updatedTables = JSON.parse(JSON.stringify(leagueTables));
            setLeagueTables(updatedTables);

            Object.keys(allLeagues).forEach(leagueKey => {
              const league = allLeagues[leagueKey];
              const teams = league.teams;
              
              const availableTeams = leagueKey === selectedLeague 
                ? teams.filter(t => t.id !== selectedTeam.id)
                : teams;

              if (availableTeams.length >= 2) {
                const shuffled = [...availableTeams].sort(() => Math.random() - 0.5);
                const team1 = shuffled[0];
                const team2 = shuffled[1];

                const result = simulateMatch(team1, team2);
                updateLeagueTable(leagueKey, team1.id, team2.id, result.homeScore, result.awayScore);
              }
            });
          };

          const playNextMatch = () => {
            const league = allLeagues[selectedLeague];
            const otherTeams = league.teams.filter(t => t.id !== selectedTeam.id);
            const opponent = otherTeams[Math.floor(Math.random() * otherTeams.length)];
            
            const isHome = Math.random() < 0.5;
            const result = isHome 
              ? simulateMatch(selectedTeam, opponent)
              : simulateMatch(opponent, selectedTeam);
            
            const playerScore = isHome ? result.homeScore : result.awayScore;
            const opponentScore = isHome ? result.awayScore : result.homeScore;
            
            setCurrentMatch({
              opponent: opponent.name,
              playerScore,
              opponentScore,
              isHome
            });
            
            setMatchCommentary(result.commentary);
            updateLeagueTable(selectedLeague, selectedTeam.id, opponent.id, playerScore, opponentScore);
            simulateOtherMatches();
            setMatchesPlayed(matchesPlayed + 1);
            setGameState('match-result');
          };

          const calculateAge = (dob) => {
            const birthDate = new Date(dob);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
              age--;
            }
            return age;
          };

          const formatCurrency = (amount) => {
            return '¬£' + (amount / 1000000).toFixed(1) + 'M';
          };

          // Show loading screen
          if (!databaseLoaded || !initialLeagues) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 flex items-center justify-center">
                <div className="text-center">
                  <div className="w-16 h-16 mx-auto mb-4 text-yellow-400 animate-pulse flex items-center justify-center">
                    <Trophy />
                  </div>
                  <div className="text-white text-2xl">Loading game data...</div>
                </div>
              </div>
            );
          }

          // Main Menu
          if (gameState === 'main-menu') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 p-4 flex items-center justify-center">
                <div className="max-w-md w-full">
                  <div className="text-center mb-12">
                    <div className="w-24 h-24 mx-auto mb-6 text-yellow-400 flex items-center justify-center">
                      <Trophy />
                    </div>
                    <h1 className="text-5xl font-bold text-white mb-3">Title Challenge</h1>
                    <p className="text-green-200 text-lg">5 European Leagues</p>
                  </div>
                  
                  <div className="space-y-4">
                    <button
                      onClick={newGame}
                      className="w-full bg-yellow-400 text-green-900 py-6 rounded-lg font-bold text-xl hover:bg-yellow-300 transition-all flex items-center justify-center gap-3"
                    >
                      <Play />
                      New Game
                    </button>
                    
                    <button
                      onClick={resumeGame}
                      disabled={!hasSavedGame()}
                      className={`w-full py-6 rounded-lg font-bold text-xl transition-all flex items-center justify-center gap-3 ${
                        hasSavedGame()
                          ? 'bg-white/20 text-white hover:bg-white/30'
                          : 'bg-white/5 text-gray-500 cursor-not-allowed'
                      }`}
                    >
                      <Save />
                      Resume Game
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // League Selection
          if (gameState === 'league-select') {
            const leagueFlags = {
              england: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',
              germany: 'üá©üá™',
              spain: 'üá™üá∏',
              france: 'üá´üá∑',
              italy: 'üáÆüáπ'
            };

            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="text-center mb-8 pt-8">
                    <div className="w-16 h-16 mx-auto mb-4 text-yellow-400 flex items-center justify-center">
                      <Globe />
                    </div>
                    <h1 className="text-4xl font-bold text-white mb-2">Choose Your League</h1>
                    <p className="text-green-200">Select from 5 European competitions</p>
                  </div>
                  
                  <div className="grid gap-4">
                    {Object.keys(initialLeagues).map(leagueKey => {
                      const league = initialLeagues[leagueKey];
                      return (
                        <div
                          key={leagueKey}
                          onClick={() => selectLeague(leagueKey)}
                          className="bg-white/10 backdrop-blur-sm rounded-lg p-6 cursor-pointer hover:bg-white/20 transition-all border-2 border-white/20 hover:border-yellow-400"
                        >
                          <div className="flex justify-between items-center">
                            <div>
                              <h2 className="text-3xl font-bold text-white mb-2">
                                {leagueFlags[leagueKey]} {league.name}
                              </h2>
                              <p className="text-green-200">{league.country}</p>
                              <p className="text-green-200 text-sm">{league.teams.length} teams</p>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>

                  <button
                    onClick={() => setGameState('main-menu')}
                    className="w-full mt-4 bg-white/20 text-white py-3 rounded-lg font-semibold hover:bg-white/30 transition-all"
                  >
                    Back to Menu
                  </button>
                </div>
              </div>
            );
          }

          // Team Selection
          if (gameState === 'team-select') {
            const league = initialLeagues[selectedLeague];
            
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="text-center mb-8 pt-8">
                    <div className="w-16 h-16 mx-auto mb-4 text-yellow-400 flex items-center justify-center">
                      <Trophy />
                    </div>
                    <h1 className="text-4xl font-bold text-white mb-2">{league.name}</h1>
                    <p className="text-green-200">Choose your team</p>
                  </div>
                  
                  <div className="grid gap-4">
                    {league.teams.map(team => (
                      <div
                        key={team.id}
                        onClick={() => selectTeam(team)}
                        className="bg-white/10 backdrop-blur-sm rounded-lg p-6 cursor-pointer hover:bg-white/20 transition-all border-2 border-white/20 hover:border-yellow-400"
                      >
                        <div className="flex justify-between items-center flex-wrap gap-4">
                          <div>
                            <h2 className="text-2xl font-bold text-white mb-2">{team.name}</h2>
                            <p className="text-green-200">Squad: {team.players.length} players</p>
                            <p className="text-green-200">Budget: {formatCurrency(team.budget)}</p>
                          </div>
                          <div className="text-center">
                            <div className="text-3xl font-bold text-yellow-400">{getTeamRating(team)}</div>
                            <div className="text-sm text-green-200">Rating</div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  <button
                    onClick={() => setGameState('league-select')}
                    className="w-full mt-4 bg-white/20 text-white py-3 rounded-lg font-semibold hover:bg-white/30 transition-all"
                  >
                    Back to Leagues
                  </button>
                </div>
              </div>
            );
          }

          // Squad/League/Transfers view
          if (gameState === 'squad' || gameState === 'league-table' || gameState === 'all-leagues' || gameState === 'transfers') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 p-4">
                <div className="max-w-6xl mx-auto">
                  <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-4">
                    <div className="flex justify-between items-center flex-wrap gap-4">
                      <div>
                        <h1 className="text-3xl font-bold text-white mb-2">{selectedTeam.name}</h1>
                        <p className="text-green-200">
                          {allLeagues[selectedLeague].name} | Matches: {matchesPlayed} | Budget: {formatCurrency(selectedTeam.budget)}
                        </p>
                      </div>
                      <button
                        onClick={() => setGameState('main-menu')}
                        className="bg-white/20 text-white px-4 py-2 rounded-lg hover:bg-white/30 transition-all flex items-center gap-2"
                      >
                        <Home />
                        Menu
                      </button>
                    </div>
                  </div>

                  <div className="flex gap-2 mb-4 flex-wrap">
                    <button
                      onClick={() => setGameState('squad')}
                      className={`px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 ${
                        gameState === 'squad' ? 'bg-yellow-400 text-green-900' : 'bg-white/10 text-white hover:bg-white/20'
                      }`}
                    >
                      <Users />
                      Squad
                    </button>
                    <button
                      onClick={() => setGameState('transfers')}
                      className={`px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 ${
                        gameState === 'transfers' ? 'bg-yellow-400 text-green-900' : 'bg-white/10 text-white hover:bg-white/20'
                      }`}
                    >
                      <ArrowLeftRight />
                      Transfers
                    </button>
                    <button
                      onClick={() => setGameState('league-table')}
                      className={`px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 ${
                        gameState === 'league-table' ? 'bg-yellow-400 text-green-900' : 'bg-white/10 text-white hover:bg-white/20'
                      }`}
                    >
                      <TrendingUp />
                      My League
                    </button>
                    <button
                      onClick={() => setGameState('all-leagues')}
                      className={`px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 ${
                        gameState === 'all-leagues' ? 'bg-yellow-400 text-green-900' : 'bg-white/10 text-white hover:bg-white/20'
                      }`}
                    >
                      <Globe />
                      All Leagues
                    </button>
                  </div>

                  {gameState === 'squad' && (
                    <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-4">
                      <h2 className="text-2xl font-bold text-white mb-4">Your Squad</h2>
                      <div className="space-y-2">
                        {['GK', 'DEF', 'MID', 'FWD'].map(position => {
                          const posPlayers = selectedTeam.players.filter(p => p.position === position);
                          return (
                            <div key={position}>
                              <h3 className="text-lg font-semibold text-yellow-400 mb-2 mt-4">
                                {position === 'GK' ? 'Goalkeeper' : position === 'DEF' ? 'Defenders' : position === 'MID' ? 'Midfielders' : 'Forwards'}
                              </h3>
                              {posPlayers.map(player => (
                                <div key={player.id} className="bg-white/5 rounded p-3 flex justify-between items-center flex-wrap gap-2">
                                  <div>
                                    <span className="text-white font-semibold">{player.name}</span>
                                    <span className="text-green-200 ml-4">Age: {calculateAge(player.dob)}</span>
                                    <span className="text-green-200 ml-4">Value: {formatCurrency(player.value)}</span>
                                  </div>
                                  <div className="text-yellow-400 font-bold text-xl">{player.rating}/20</div>
                                </div>
                              ))}
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  )}

                  {gameState === 'transfers' && (
                    <div className="space-y-4">
                      {selectedPlayerForTransfer ? (
                        <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6">
                          <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-white">Transfer {selectedPlayerForTransfer.name}</h2>
                            <button
                              onClick={() => setSelectedPlayerForTransfer(null)}
                              className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
                            >
                              Cancel
                            </button>
                          </div>
                          <p className="text-green-200 mb-4">Value: {formatCurrency(selectedPlayerForTransfer.value)}</p>
                          <h3 className="text-xl font-bold text-white mb-3">Select destination team:</h3>
                          <div className="space-y-2">
                            {Object.keys(allLeagues).map(leagueKey => {
                              const league = allLeagues[leagueKey];
                              return league.teams.filter(t => t.id !== selectedTeam.id).map(team => {
                                const canAfford = team.budget >= selectedPlayerForTransfer.value;
                                return (
                                  <div
                                    key={team.id}
                                    onClick={() => {
                                      if (canAfford) {
                                        const updatedLeagues = JSON.parse(JSON.stringify(allLeagues));
                                        Object.keys(updatedLeagues).forEach(lk => {
                                          updatedLeagues[lk].teams = updatedLeagues[lk].teams.map(t => {
                                            if (t.id === selectedTeam.id) {
                                              return {
                                                ...t,
                                                budget: t.budget + selectedPlayerForTransfer.value,
                                                players: t.players.filter(p => p.id !== selectedPlayerForTransfer.id)
                                              };
                                            }
                                            if (t.id === team.id) {
                                              return {
                                                ...t,
                                                budget: t.budget - selectedPlayerForTransfer.value,
                                                players: [...t.players, selectedPlayerForTransfer]
                                              };
                                            }
                                            return t;
                                          });
                                        });
                                        setAllLeagues(updatedLeagues);
                                        setSelectedTeam(updatedLeagues[selectedLeague].teams.find(t => t.id === selectedTeam.id));
                                        setSelectedPlayerForTransfer(null);
                                        alert(`${selectedPlayerForTransfer.name} transferred to ${team.name}!`);
                                      }
                                    }}
                                    className={`bg-white/5 rounded p-4 transition-all flex justify-between items-center ${
                                      canAfford ? 'cursor-pointer hover:bg-white/10' : 'opacity-50 cursor-not-allowed'
                                    }`}
                                  >
                                    <div>
                                      <div className="text-white font-semibold">{team.name}</div>
                                      <div className="text-green-200 text-sm">{league.name}</div>
                                      <div className="text-green-200">Budget: {formatCurrency(team.budget)}</div>
                                    </div>
                                    {!canAfford && <span className="text-red-400 text-sm">Insufficient funds</span>}
                                  </div>
                                );
                              });
                            })}
                          </div>
                        </div>
                      ) : (
                        <>
                          <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6">
                            <h2 className="text-2xl font-bold text-white mb-4">Your Squad</h2>
                            <p className="text-green-200 mb-4">Click a player to sell them</p>
                            <div className="space-y-2">
                              {selectedTeam.players.map(player => (
                                <div
                                  key={player.id}
                                  onClick={() => setSelectedPlayerForTransfer(player)}
                                  className="bg-white/5 rounded p-3 flex justify-between items-center cursor-pointer hover:bg-white/10 transition-all flex-wrap gap-2"
                                >
                                  <div>
                                    <span className="text-white font-semibold">{player.name}</span>
                                    <span className="text-green-200 ml-4">{player.position}</span>
                                    <span className="text-green-200 ml-4">Age: {calculateAge(player.dob)}</span>
                                  </div>
                                  <div className="flex items-center gap-4">
                                    <span className="text-yellow-400 font-bold">{player.rating}/20</span>
                                    <span className="text-green-400">{formatCurrency(player.value)}</span>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>

                          <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6">
                            <h2 className="text-2xl font-bold text-white mb-4">Available Players - All Leagues</h2>
                            {Object.keys(allLeagues).map(leagueKey => {
                              const league = allLeagues[leagueKey];
                              return (
                                <div key={leagueKey} className="mb-6">
                                  <h3 className="text-xl font-semibold text-yellow-400 mb-3">{league.name}</h3>
                                  {league.teams.filter(t => t.id !== selectedTeam.id).map(team => (
                                    <div key={team.id} className="mb-4">
                                      <h4 className="text-lg font-semibold text-white mb-2">{team.name}</h4>
                                      <div className="space-y-2">
                                        {team.players.slice(0, 3).map(player => {
                                          const canAfford = selectedTeam.budget >= player.value;
                                          return (
                                            <div
                                              key={player.id}
                                              onClick={() => {
                                                if (canAfford) {
                                                  if (confirm(`Sign ${player.name} for ${formatCurrency(player.value)}?`)) {
                                                    const updatedLeagues = JSON.parse(JSON.stringify(allLeagues));
                                                    Object.keys(updatedLeagues).forEach(lk => {
                                                      updatedLeagues[lk].teams = updatedLeagues[lk].teams.map(t => {
                                                        if (t.id === team.id) {
                                                          return {
                                                            ...t,
                                                            budget: t.budget + player.value,
                                                            players: t.players.filter(p => p.id !== player.id)
                                                          };
                                                        }
                                                        if (t.id === selectedTeam.id) {
                                                          return {
                                                            ...t,
                                                            budget: t.budget - player.value,
                                                            players: [...t.players, player]
                                                          };
                                                        }
                                                        return t;
                                                      });
                                                    });
                                                    setAllLeagues(updatedLeagues);
                                                    setSelectedTeam(updatedLeagues[selectedLeague].teams.find(t => t.id === selectedTeam.id));
                                                    alert(`${player.name} signed!`);
                                                  }
                                                } else {
                                                  alert('Insufficient budget!');
                                                }
                                              }}
                                              className={`bg-white/5 rounded p-2 transition-all flex justify-between items-center flex-wrap gap-2 text-sm ${
                                                canAfford ? 'cursor-pointer hover:bg-white/10' : 'opacity-50 cursor-not-allowed'
                                              }`}
                                            >
                                              <div>
                                                <span className="text-white font-semibold">{player.name}</span>
                                                <span className="text-green-200 ml-2">{player.position}</span>
                                                <span className="text-green-200 ml-2">Age: {calculateAge(player.dob)}</span>
                                              </div>
                                              <div className="flex items-center gap-2">
                                                <span className="text-yellow-400 font-bold">{player.rating}/20</span>
                                                <span className={canAfford ? 'text-green-400' : 'text-red-400'}>
                                                  {formatCurrency(player.value)}
                                                </span>
                                              </div>
                                            </div>
                                          );
                                        })}
                                      </div>
                                    </div>
                                  ))}
                                </div>
                              );
                            })}
                          </div>
                        </>
                      )}
                    </div>
                  )}

                  {gameState === 'league-table' && (
                    <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-4">
                      <h2 className="text-2xl font-bold text-white mb-4">{allLeagues[selectedLeague].name} Table</h2>
                      <div className="overflow-x-auto">
                        <table className="w-full text-white text-sm">
                          <thead>
                            <tr className="border-b border-white/20">
                              <th className="text-left p-2">Pos</th>
                              <th className="text-left p-2">Team</th>
                              <th className="text-center p-2">P</th>
                              <th className="text-center p-2">W</th>
                              <th className="text-center p-2">D</th>
                              <th className="text-center p-2">L</th>
                              <th className="text-center p-2">GF</th>
                              <th className="text-center p-2">GA</th>
                              <th className="text-center p-2">GD</th>
                              <th className="text-center p-2">Pts</th>
                            </tr>
                          </thead>
                          <tbody>
                            {leagueTables[selectedLeague]?.map((team, index) => (
                              <tr
                                key={team.teamId}
                                className={`border-b border-white/10 ${
                                  team.teamId === selectedTeam.id ? 'bg-yellow-400/20' : ''
                                }`}
                              >
                                <td className="p-2 font-bold">{index + 1}</td>
                                <td className="p-2">{team.name}</td>
                                <td className="text-center p-2">{team.played}</td>
                                <td className="text-center p-2">{team.won}</td>
                                <td className="text-center p-2">{team.drawn}</td>
                                <td className="text-center p-2">{team.lost}</td>
                                <td className="text-center p-2">{team.goalsFor}</td>
                                <td className="text-center p-2">{team.goalsAgainst}</td>
                                <td className="text-center p-2">{team.goalsFor - team.goalsAgainst}</td>
                                <td className="text-center p-2 font-bold">{team.points}</td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  )}

                  {gameState === 'all-leagues' && (
                    <div className="space-y-4">
                      {Object.keys(allLeagues).map(leagueKey => {
                        const league = allLeagues[leagueKey];
                        return (
                          <div key={leagueKey} className="bg-white/10 backdrop-blur-sm rounded-lg p-6">
                            <h2 className="text-2xl font-bold text-white mb-4">{league.name}</h2>
                            <div className="overflow-x-auto">
                              <table className="w-full text-white text-sm">
                                <thead>
                                  <tr className="border-b border-white/20">
                                    <th className="text-left p-2">Pos</th>
                                    <th className="text-left p-2">Team</th>
                                    <th className="text-center p-2">P</th>
                                    <th className="text-center p-2">W</th>
                                    <th className="text-center p-2">D</th>
                                    <th className="text-center p-2">L</th>
                                    <th className="text-center p-2">Pts</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {leagueTables[leagueKey]?.map((team, index) => (
                                    <tr
                                      key={team.teamId}
                                      className={`border-b border-white/10 ${
                                        team.teamId === selectedTeam.id ? 'bg-yellow-400/20' : ''
                                      }`}
                                    >
                                      <td className="p-2 font-bold">{index + 1}</td>
                                      <td className="p-2">{team.name}</td>
                                      <td className="text-center p-2">{team.played}</td>
                                      <td className="text-center p-2">{team.won}</td>
                                      <td className="text-center p-2">{team.drawn}</td>
                                      <td className="text-center p-2">{team.lost}</td>
                                      <td className="text-center p-2 font-bold">{team.points}</td>
                                    </tr>
                                  ))}
                                </tbody>
                              </table>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}

                  <button
                    onClick={playNextMatch}
                    className="w-full bg-yellow-400 text-green-900 py-4 rounded-lg font-bold text-xl hover:bg-yellow-300 transition-all flex items-center justify-center gap-2"
                  >
                    <Calendar />
                    Play Next Match
                  </button>
                </div>
              </div>
            );
          }

          // Match Result
          if (gameState === 'match-result') {
            const resultText = 
              currentMatch.playerScore > currentMatch.opponentScore ? 'VICTORY!' :
              currentMatch.playerScore < currentMatch.opponentScore ? 'DEFEAT' :
              'DRAW';
            
            const resultColor = 
              currentMatch.playerScore > currentMatch.opponentScore ? 'text-green-400' :
              currentMatch.playerScore < currentMatch.opponentScore ? 'text-red-400' :
              'text-yellow-400';

            return (
              <div className="min-h-screen bg-gradient-to-br from-green-900 via-green-800 to-green-900 p-4">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-4">
                    <h1 className={`text-4xl font-bold text-center mb-4 ${resultColor}`}>{resultText}</h1>
                    <div className="text-center text-white text-3xl font-bold mb-2">
                      {currentMatch.isHome ? selectedTeam.name : currentMatch.opponent} {currentMatch.playerScore} - {currentMatch.opponentScore} {currentMatch.isHome ? currentMatch.opponent : selectedTeam.name}
                    </div>
                  </div>

                  <div className="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-4 max-h-96 overflow-y-auto">
                    <h2 className="text-2xl font-bold text-white mb-4">Match Commentary</h2>
                    {matchCommentary.map((comment, index) => (
                      <p key={index} className="text-green-100 mb-2 font-mono text-sm">
                        {comment}
                      </p>
                    ))}
                  </div>

                  <div className="flex gap-4 flex-wrap">
                    <button
                      onClick={() => setGameState('all-leagues')}
                      className="flex-1 min-w-[200px] bg-white/20 text-white py-4 rounded-lg font-bold hover:bg-white/30 transition-all"
                    >
                      View All Leagues
                    </button>
                    <button
                      onClick={playNextMatch}
                      className="flex-1 min-w-[200px] bg-yellow-400 text-green-900 py-4 rounded-lg font-bold hover:bg-yellow-300 transition-all"
                    >
                      Next Match
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
